<!DOCTYPE html>
<html>
  <head>
    <title>DeskShare</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.min.css" %>
    <%= stylesheet_link_tag "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" %>
    <%= stylesheet_link_tag "https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.css" %>
    
    <!-- Load jQuery first -->
    <%= javascript_include_tag "https://code.jquery.com/jquery-3.7.1.min.js", crossorigin: "anonymous", integrity: "sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" %>
    
    <!-- Load jQuery UI -->
    <%= javascript_include_tag "https://code.jquery.com/ui/1.13.2/jquery-ui.min.js", crossorigin: "anonymous" %>
    
    <!-- Load Toastr JavaScript after jQuery -->
    <%= javascript_include_tag "https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.js" %>
    
    <!-- Font Awesome is already loaded via CDN -->
    
    <%= javascript_importmap_tags %>

    <%= javascript_include_tag "https://maps.googleapis.com/maps/api/js?key=#{ ENV['MAPS_API_KEY']}&libraries=places&loading=async",
                            async: true,
                            defer: true,
                            "data-turbo-eval": false %>
    
    <script>
      // Google Maps API 디버깅 로그
      console.log('=== Google Maps API Debug ===');
      console.log('Current page:', window.location.pathname);
      console.log('Environment:', '<%= Rails.env %>');
      console.log('API Key present:', '<%= ENV['MAPS_API_KEY'].present? %>');
      console.log('API Key starts with:', '<%= ENV['MAPS_API_KEY']&.first(10) %>');
      
      // Google Maps API 로딩 상태 확인
      window.addEventListener('load', function() {
        console.log('Page loaded, checking Google Maps API...');
        
        // API 키 확인
        const script = document.querySelector('script[src*="maps.googleapis.com"]');
        if (script) {
          console.log('✅ Google Maps script found:', script.src);
        } else {
          console.error('❌ Google Maps script not found');
        }
        
        // Google Maps 객체 확인
        setTimeout(function() {
          if (typeof google !== 'undefined' && google.maps) {
            console.log('✅ Google Maps API loaded successfully');
            console.log('Available services:', Object.keys(google.maps));
          } else {
            console.error('❌ Google Maps API not loaded');
            console.log('Google object:', typeof google);
            if (typeof google !== 'undefined') {
              console.log('Google maps object:', typeof google.maps);
            }
          }
        }, 2000);
      });
      
      // Google Maps API 에러 핸들링
      window.gm_authFailure = function() {
        console.error('❌ Google Maps API authentication failed');
        console.log('This usually means the API key is invalid or has restrictions');
      };
      
      window.gm_authFailure = function() {
        console.error('❌ Google Maps API authentication failed');
      };
    </script>
    <%= favicon_link_tag asset_path('orangePolygonLarge.png') %>
    
    <!-- Font Awesome star rating system is now handled in individual pages -->
  </head>

  <body>
    <script>
function openMobileDrawer() {
  document.getElementById('mobileDrawer').classList.add('open');
  document.getElementById('mobileBackdrop').classList.add('show');
}
function closeMobileDrawer() {
  document.getElementById('mobileDrawer').classList.remove('open');
  document.getElementById('mobileBackdrop').classList.remove('show');
}
</script>
    <%# navbar %>
    <%= render 'shared/navbar' %>      
  
    <%# main %>
    <%= render 'shared/message'%>
    <div class="container main" id="main">

      <%= yield %>

    </div>
    <%= render 'shared/footer' %>
  </body>
</html>
