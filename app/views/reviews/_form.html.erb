<%= form_with model: [@room, @room.reviews.new], local: true do |f|%>
<div class="card p-3 shadow">
    <div class="form-group d-flex">
        <div class="p-2 col-md-6"><%= f.text_field :comment, placeholder: "Write review..", class: "form-control" %></div>
        <span class="p-2 mt-1">Rate: </span><div id="stars" class="mt-2 pr-2 pl-2 star_min_width"></div>
        <div class="p-2"><%= f.hidden_field :room_id, value: @room.id %></div>

        <div class="actions">
            <%= f.submit "Create Review", class: "btn btn-primary mt-2"%>
        </div>
    </div>

</div>
<% end %>

<script>
console.log('[Raty Review Form Debug] Review form script loaded');

function initializeReviewRaty() {
    console.log('[Raty Review Form Debug] initializeReviewRaty called');
    
    if (typeof $ !== 'undefined' && typeof $.fn.raty !== 'undefined') {
        console.log('[Raty Review Form Debug] jQuery and Raty available in review form');
        
        const starsElement = document.getElementById('stars');
        console.log('[Raty Review Form Debug] Stars element found:', starsElement);
        
        const starOff = '<%= asset_path('star-off.png') %>';
        const starOn = '<%= asset_path('star-on.png') %>';
        const starHalf = '<%= asset_path('star-half.png') %>';
        
        console.log('[Raty Review Form Debug] Image paths:', {
            starOff: starOff,
            starOn: starOn,
            starHalf: starHalf
        });
        
        try {
            $('#stars').raty({
                scoreName: 'review[star]',
                score: 1,
                starOff: starOff,
                starOn: starOn,
                starHalf: starHalf,
            });
            console.log('[Raty Review Form Debug] Review form raty initialized successfully');
        } catch (error) {
            console.error('[Raty Review Form Debug] Error initializing review form raty:', error);
        }
    } else {
        console.log('[Raty Review Form Debug] Dependencies not available:', {
            jquery: typeof $,
            raty: typeof $.fn?.raty
        });
        setTimeout(initializeReviewRaty, 200);
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    console.log('[Raty Review Form Debug] DOMContentLoaded event fired for review form');
    initializeReviewRaty();
});

document.addEventListener('turbo:load', function() {
    console.log('[Raty Review Form Debug] turbo:load event fired for review form');
    initializeReviewRaty();
});
</script>