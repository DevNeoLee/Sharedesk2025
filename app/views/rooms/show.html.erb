
<div class="card mb-3 shadow room-section-card">
  <div class="card-header bg-light">
    <div class="d-flex justify-content-between align-items-center flex-wrap room-header-row">
      <div class="d-flex align-items-center flex-wrap">
        <h1 class="ml-2 p-2 m-2 mb-0 room-title"><%= @room.listing_name %></h1>
        <div class="star-rating ml-3 mt-1" data-score="<%= @room.average_rating || 0 %>"></div>
      </div>
      <div class="room-address text-right pr-3">
        <h5 class="mb-0"><%= @room.address %></h5>
      </div>
    </div>
  </div>
  <div class="room-image-slider p-4 text-center">
    <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">                    
      <% if @room.images.attached? %>
        <ol class="carousel-indicators">
          <% @room.images.each do |image| %>
            <li data-target="#carouselExampleIndicators" data-slide-to="<%= image.id %>"></li>
          <% end %>
        </ol>
      <% end %>
      <div class="carousel-inner">
        <% if @room.images.attached? %>
          <% @room.images.each_with_index do |image, i| %>
            <div class="carousel-item <%='active' if i == 0%>">
              <%= image_tag image, class: "image_carousel img-fluid rounded room-main-image"%>
            </div>
          <% end %>
        <% end %>
      </div>
      <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>
  </div>
</div>

<div class="card mb-3 shadow room-section-card">
  <div class="card-header bg-light"><h4>About & Manager</h4></div>
  <div class="row p-4 align-items-center">
    <div class="col-md-7">
      <p class="about-text h5 mb-0"><%= @room.summary %></p>
    </div>
    <div class="col-md-5 manager-info text-center">
      <div class="mb-2">Managed by:</div>
      <%= link_to user_path(@room.user.id) do%>
        <%= image_tag (@room.user.default_avatar), class: "img-circle avatar-large mb-2"%>                      
      <% end %>
      <div class="font-weight-bold"><%= @room.user.name %></div>
      <div class="text-muted small"><%= @room.user.email %></div>
    </div>
  </div>
</div>

<div class="card shadow mb-3 room-section-card">
  <div class="card-header bg-light"><h4>Info</h4></div>
  <div class="row text-center info_text room-info-grid p-4">
    <div class="col-md-3 mb-4 p-3">
      <div class="info-icon mb-2"><i class="fas fa-building fa-2x"></i></div>
      <div>Operating in <%= @room.space_type %></div>
    </div>
    <div class="col-md-3 mb-4 p-3">
      <div class="info-icon mb-2"><i class="fas fa-chair fa-2x"></i></div>
      <div><%= @room.desk_type %> Type</div>
    </div>
    <div class="col-md-3 mb-4 p-3">
      <div class="info-icon mb-2"><i class="fas fa-users fa-2x"></i></div>
      <div>Capacity: <%= @room.capacity %> <%= @room.capacity > 1 ? "Seats" : "Seat" %></div>
    </div>
    <div class="col-md-3 mb-4 p-3">
      <div class="info-icon mb-2"><i class="fas fa-volume-up fa-2x"></i></div>
      <div>Noise Level: <%= @room.noise_level %></div>
    </div>
    <div class="col-md-3 mb-4 p-3">
      <div class="info-icon mb-2"><i class="fas fa-user-shield fa-2x"></i></div>
      <div>Manager: <%= @room.manager_on %></div>
    </div>
    <div class="col-md-3 mb-4 p-3">
      <div class="info-icon mb-2"><i class="fas fa-shield-alt fa-2x"></i></div>
      <div>Security: <%= @room.security_level %></div>
    </div>
    <div class="col-md-3 mb-4 p-3">
      <div class="info-icon mb-2"><i class="fas fa-bath fa-2x"></i></div>
      <div><%= @room.bath_room %> <%= @room.bath_room > 1 ? "Bathrooms" : "Bathroom" %></div>
    </div>
    <div class="col-md-3 mb-4 p-3">
      <div class="info-icon mb-2"><i class="fas fa-dollar-sign fa-2x"></i></div>
      <div>Price: $<%= @room.price %> / day</div>
    </div>
  </div>
</div>

<div class="card shadow mb-3 room-section-card">
  <div class="card-header bg-light"><h4>Amenities</h4></div>
  <div class="row room-amenity-grid p-4">
    <div class="col-md-4 text-center">
      <ul class="amenities list-unstyled">
        <li class="p-3 <%= 'text-line-through text-muted' if !@room.is_wifi %>"><i class="fas fa-wifi fa-lg"></i> Wifi/Internet</li>
        <li class="p-3 <%= 'text-line-through text-muted' if !@room.is_conference %>"><i class="fas fa-phone-square-alt fa-lg"></i> Conference Call Space</li>
        <li class="p-3 <%= 'text-line-through text-muted' if !@room.is_kitchen %>"><i class="fas fa-sink fa-lg"></i> Kitchen</li>
      </ul>
    </div>
    <div class="col-md-4 text-center">
      <ul class="amenities list-unstyled">
        <li class="p-3 <%= 'text-line-through text-muted' if !@room.is_drinks %>"><i class="fas fa-wine-glass-alt fa-lg"></i> Free Drinks</li>
        <li class="p-3 <%= 'text-line-through text-muted' if !@room.is_heating %>"><i class="fas fa-fire fa-lg"></i> Heating</li>
        <li class="p-3 <%= 'text-line-through text-muted' if !@room.is_printing %>"><i class="fas fa-print fa-lg"></i> Printing Station</li>
      </ul>
    </div>
    <div class="col-md-4 text-center">
      <ul class="amenities list-unstyled">
        <li class="p-3 <%= 'text-line-through text-muted' if !@room.is_parking %>"><i class="fas fa-parking fa-lg"></i> Parking</li>
        <li class="p-3 <%= 'text-line-through text-muted' if !@room.is_air %>"><i class="fas fa-fan fa-lg"></i> Air-Conditioning</li>
      </ul>
    </div>
  </div>
</div>

<div class="card shadow mb-3 room-section-card">
  <div class="card-header bg-light"><h4>Location</h4></div>
  <div class="p-4 text-center">
    <%= image_tag map_image_room_path(@room), alt: "Map", class: "rounded shadow room-map-image" %>        
  </div>
</div>

<%= render 'reservations/form' %>

<%# Reviews %>
<div class="card shadow room-section-card">
  <div class="card-header bg-light">
    <h4>Review (<%= @reviews.count %>)</h4>        
  </div>
  <div class="p-0"><%= render 'reviews/form' if @booked && !@hasReview %></div>
  <%= render partial: 'reviews/review', locals: {reviews: @reviews} %>
</div>

<div class="bg-light p-5 rounded mt-5 room-section-card">
  <div class="h3 mb-4 p-2">Other Spaces Near By: </div> 
  <div class="row">
    <% if @room.nearbys(15) == nil || @room.nearbys(15).length == 0 %>
      <p class="ml-4">There is no space near by </p>
    <% else %>
      <% @room.nearbys(15).each do |room| %>
        <div class="col-md-4 mb-3">
          <%= link_to room_path(room.id) do %>
            <div class="card shadow m-2 city-card text-center d-flex flex-column justify-content-between" style="min-height: 400px; max-width: 370px; margin: 0 auto;">
              <% if room.images.attached? %>
                <%= image_tag room.medium_image(room.images[0]), class: "img-fluid image-medium mt-3" %>
              <% else %>
                <div class="image-medium d-flex align-items-center justify-content-center bg-light mt-3 mb-2" style="height:200px; border-radius:8px; color:#bbb; font-size:2rem;">No Image</div>
              <% end %>
              <div class="card-body flex-grow-1 d-flex flex-column justify-content-center">
                <div class="h5 mb-2"><%= room.listing_name %></div>
                <div class="mb-2 text-muted small"><%= room.address %></div>
                <div class="mb-2 text-muted small">(<%= room.distance.round(2) %> miles away)</div>
              </div>
              <div class="star-rating star-rating-large pb-3" data-score="<%= room.average_rating || 0 %>"></div>
            </div>
          <% end %>
        </div>
      <% end %>
    <% end %>    
  </div>
</div>
<script>
console.log('[Raty Room Show Debug] Room show script loaded');

function initializeShowRaty() {
    console.log('[Raty Room Show Debug] initializeShowRaty called');
    
    if (typeof $ !== 'undefined' && typeof $.fn.raty !== 'undefined') {
        console.log('[Raty Room Show Debug] jQuery and Raty available in room show');
        
        const averageRatingElement = document.getElementById('average_rating');
        console.log('[Raty Room Show Debug] Average rating element found:', averageRatingElement);
        
        const starOff = '<%= asset_path('star-off.png') %>';
        const starOn = '<%= asset_path('star-on.png') %>';
        const starHalf = '<%= asset_path('star-half.png') %>';
        
        console.log('[Raty Room Show Debug] Image paths:', {
            starOff: starOff,
            starOn: starOn,
            starHalf: starHalf
        });
        
        console.log('[Raty Room Show Debug] Room average rating:', <%= @room.average_rating %>);
        
        try {
            $('#average_rating').raty({
                readOnly: true,
                score: <%= @room.average_rating %>,
                starOff: starOff,
                starOn: starOn,
                starHalf: starHalf,
            });
            console.log('[Raty Room Show Debug] Room show raty initialized successfully');
        } catch (error) {
            console.error('[Raty Room Show Debug] Error initializing room show raty:', error);
        }
    } else {
        console.log('[Raty Room Show Debug] Dependencies not available:', {
            jquery: typeof $,
            raty: typeof $.fn?.raty
        });
        setTimeout(initializeShowRaty, 200);
    }
}

// 페이지 로드 시 초기화
document.addEventListener('DOMContentLoaded', function() {
    console.log('[Raty Room Show Debug] DOMContentLoaded event fired for room show');
    initializeShowRaty();
});

document.addEventListener('turbo:load', function() {
    console.log('[Raty Room Show Debug] turbo:load event fired for room show');
    initializeShowRaty();
});
</script>


